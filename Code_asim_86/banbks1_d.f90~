!        Generated by TAPENADE     (INRIA, Tropics team)
!  Tapenade 3.4 (r3342) - 27 Jan 2010 15:25
!
!  Differentiation of banbks1 in forward (tangent) mode:
!   variations   of useful results: x
!   with respect to varying inputs: x b
!*******************************************************
!*******************************************************
!
SUBROUTINE BANBKS1_D(a, n, m, m1, m2, al, indx, b, bd, x, xd)
!
  implicit none
!
  INTEGER :: n, m1, m2, l, mm, m, i, k, j
!
  REAL*8, DIMENSION(n/2, m1) :: al
  REAL*8, DIMENSION(n/2, m1 + m2 + 1) :: a
  REAL*8, DIMENSION(n/2) :: indx
  REAL*8, DIMENSION(n/2) :: b, x
  REAL*8, DIMENSION(n/2) :: bd, xd
  INTEGER, DIMENSION(n/2) :: lv, lu
  REAL*8 :: piv1, piv2
  REAL*8 :: piv1d, piv2d
!      
  mm = m1 + m2 + 1
!
  DO i=1,n/2
    xd(i) = bd(i)
    x(i) = b(i)
  END DO
!
  l = m1
  DO k=1,n/2
    IF (l .LT. n/2) l = l + 1
    lv(k) = l
  END DO
!
  DO k=1,n/2
    j = indx(k)
! si (j.ne.k) se cumple (j-k)=1 
    piv1d = (j-k)*xd(j) + (k-j+1)*xd(k)
    piv1 = (j-k)*x(j) + (k-j+1)*x(k)
    piv2d = (j-k)*xd(k) + (k-j+1)*xd(j)
    piv2 = (j-k)*x(k) + (k-j+1)*x(j)
    xd(k) = piv1d
    x(k) = piv1
    xd(j) = piv2d
    x(j) = piv2
    DO i=k+1,lv(k)
      xd(i) = xd(i) - al(k, i-k)*xd(k)
      x(i) = x(i) - al(k, i-k)*x(k)
    END DO
  END DO
!
  l = 1
  DO i=n/2,1,-1
    lu(i) = l
    IF (l .LT. mm) l = l + 1
  END DO
!
  DO i=n/2,1,-1
    DO k=2,lu(i)
      xd(i) = xd(i) - a(i, k)*xd(k+i-1)
      x(i) = x(i) - a(i, k)*x(k+i-1)
    END DO
    xd(i) = xd(i)/a(i, 1)
    x(i) = x(i)/a(i, 1)
  END DO
!
  RETURN
END SUBROUTINE BANBKS1_D
